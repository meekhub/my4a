select t.*, t.rowid from tmp_majh_trm_0716_01 t

TRUNCATE TABLE TMP_MAJH_0417_02


INSERT /*+ APPEND */
INTO TMP_MAJH_0417_02 NOLOGGING
  SELECT USER_NO,
         AREA_NO,
         SALES_MODE,
         TO_CHAR(BEGIN_DATE, 'YYYYMMDDHH24MISS'),
         TO_CHAR(END_DATE, 'YYYYMMDDHH24MISS'),
         COST_PRICE,
         DEVICE_NO£¬
         USER_DINNER,
         DEVICE_TYPE,
         DEVICE_NUMBER,
         CHANNEL_NO,
         TO_CHAR(SALESINST_CREATE_DATE,'YYYYMMDD') CREATE_DATE
    FROM (SELECT T.*,
                 ROW_NUMBER() OVER(PARTITION BY USER_NO ORDER BY BEGIN_DATE DESC) RN
            FROM ODS.O_PRD_USER_DEVICE_RENT_D@HBODS T
           WHERE T.ACCT_MONTH = '201808'
             AND T.DAY_ID = '27' 
             AND (END_DATE > SYSDATE OR END_DATE IS NULL))
   WHERE RN = 1;
COMMIT;
      
 
SELECT A.Terminal_Code,
       B.CREATE_DATE,
       B.SALES_MODE,
       D.NAME,
       B.USER_DINNER,
       C.USER_DINNER_DESC
  FROM 
       --TMP_MAJH_TRM_0716_01 A, 
       --tmp_majh_trm_0803_01 A,
       tmp_majh_trm_0817_01 A,
       TMP_MAJH_0417_02 B,
       DIM.DIM_USER_DINNER C,
       (SELECT * FROM DIM.DIM_SALE_MODE_NEW WHERE CITY_CODE = '188') D
 WHERE A.TERMINAL_CODE = B.DEVICE_NO(+)
   AND B.USER_DINNER = C.USER_DINNER(+)
   AND B.SALES_MODE = D.KIND(+)


--µ¼³ö
SELECT TERMINAL_CODE,
       CREATE_DATE,
       SALES_MODE,
       NAME,
       USER_DINNER,
       USER_DINNER_DESC
  FROM ALLDM.MID_HY_USER_02 T

