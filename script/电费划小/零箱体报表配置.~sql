--零箱体明细表
SELECT A.ACCT_MONTH,
       B.AREA_DESC,
       C.CITY_DESC,
       A.HUAXIAO_NAME,
       A.XIAOQU_NAME,
       A.BOX_NAME,
       A.INNET_DATE,
       A.STANDARD_NAME,
       A.STANDARD_ID,
       A.FG_CNT,
       A.KD_CNT / A.FG_CNT AS FG_RAGE
  FROM (SELECT *
          FROM ALLDM.DM_ZERO_BOX_BASE_INFO T
         WHERE 1 = 1 {AND T.ACCT_MONTH = #ACCT_MONTH#} {AND T.AREA_NO = #AREA_NO#}) A,
       (SELECT AREA_NO     FACT_AREA_ID,
               DESCRIPTION AREA_DESC,
               IDX_NO      SORT_ID,
               AREA_NO     AREA_ID
          FROM NEW_ALLDMCODE.DMCODE_AREA) B,
       (SELECT CITY_NO FACT_AREA_ID, DESCRIPTION CITY_DESC, IDX_NO SORT_ID
          FROM NEW_ALLDMCODE.DMCODE_CITY
         WHERE {AREA_NO = #AREA_NO#} {AND CITY_NO = #CITY_NO#}
           AND CITY_LEVEL = 2) C
 WHERE 1 = 1
   AND A.AREA_NO = B.FACT_AREA_ID
   AND A.CITY_NO = C.FACT_AREA_ID;

--零箱体汇总表
SELECT A.ACCT_MONTH,
       B.AREA_DESC,
       C.CITY_DESC,
       A.HUAXIAO_NAME,
       A.XIAOQU_NAME, 
       A.ZERO_CNT,
       A.ALL_CNT,
       DECODE(A.FG_CNT,0,0,A.KD_CNT / A.FG_CNT) AS FG_RAGE
  FROM (SELECT *
          FROM ALLDM.DM_ZERO_BOX_HZ_INFO T
         WHERE 1 = 1 {AND T.ACCT_MONTH = #ACCT_MONTH#} {AND T.AREA_NO = #AREA_NO#} {AND T.PROJECT_TYPE=#PROJECT_TYPE#}) A,
       (SELECT AREA_NO     FACT_AREA_ID,
               DESCRIPTION AREA_DESC,
               IDX_NO      SORT_ID,
               AREA_NO     AREA_ID
          FROM NEW_ALLDMCODE.DMCODE_AREA) B,
       (SELECT CITY_NO FACT_AREA_ID, DESCRIPTION CITY_DESC, IDX_NO SORT_ID
          FROM NEW_ALLDMCODE.DMCODE_CITY
         WHERE {AREA_NO = #AREA_NO#} {AND CITY_NO = #CITY_NO#}
           AND CITY_LEVEL = 2) C
 WHERE 1 = 1
   AND A.AREA_NO = B.FACT_AREA_ID
   AND A.CITY_NO = C.FACT_AREA_ID;
   
 
--1箱体明细
SELECT A.ACCT_MONTH,
       B.AREA_DESC,
       C.CITY_DESC,
       A.HUAXIAO_NAME,
       A.XIAOQU_NAME,
       A.BOX_NAME,
       A.INNET_DATE,
       A.STANDARD_NAME,
       A.STANDARD_ID,
       A.FG_CNT,
       DECODE(A.FG_CNT,0,0,A.KD_CNT / A.FG_CNT) AS FG_RAGE
  FROM (SELECT *
          FROM ALLDM.DM_ONE_BOX_BASE_INFO T
         WHERE 1 = 1 {AND T.ACCT_MONTH = #ACCT_MONTH#} {AND T.AREA_NO = #AREA_NO#}) A,
       (SELECT AREA_NO     FACT_AREA_ID,
               DESCRIPTION AREA_DESC,
               IDX_NO      SORT_ID,
               AREA_NO     AREA_ID
          FROM NEW_ALLDMCODE.DMCODE_AREA) B,
       (SELECT CITY_NO FACT_AREA_ID, DESCRIPTION CITY_DESC, IDX_NO SORT_ID
          FROM NEW_ALLDMCODE.DMCODE_CITY
         WHERE {AREA_NO = #AREA_NO#} {AND CITY_NO = #CITY_NO#}
           AND CITY_LEVEL = 2) C
 WHERE 1 = 1
   AND A.AREA_NO = B.FACT_AREA_ID
   AND A.CITY_NO = C.FACT_AREA_ID;
   
--零箱体整治效果后评估
SELECT A.ACCT_MONTH,
       B.AREA_DESC,
       C.CITY_DESC,
       A.HUAXIAO_NAME,
       A.XIAOQU_NAME,
       A.MINUS_CNT,
       A.DEV_CNT,
       A.MINUS_FEE,
       A.MINUS_CNT_LJ,
       A.DEV_CNT_LJ,
       A.MINUS_FEE_LJ 
  FROM (SELECT *
          FROM ALLDM.DM_BOX_EFFECT_EVAL T
         WHERE 1 = 1 
         {AND T.ACCT_MONTH = #ACCT_MONTH#} {AND T.AREA_NO = #AREA_NO#} {AND T.PROJECT_TYPE = #PROJECT_TYPE#}) A,
       (SELECT AREA_NO     FACT_AREA_ID,
               DESCRIPTION AREA_DESC,
               IDX_NO      SORT_ID,
               AREA_NO     AREA_ID
          FROM NEW_ALLDMCODE.DMCODE_AREA) B,
       (SELECT CITY_NO FACT_AREA_ID, DESCRIPTION CITY_DESC, IDX_NO SORT_ID
          FROM NEW_ALLDMCODE.DMCODE_CITY
         WHERE {AREA_NO = #AREA_NO#} {AND CITY_NO = #CITY_NO#} AND CITY_LEVEL = 2) C
 WHERE 1 = 1
   AND A.AREA_NO = B.FACT_AREA_ID
   AND A.CITY_NO = C.FACT_AREA_ID;


--箱体扩容预警表（端口占用超70%）
SELECT A.ACCT_MONTH,
       B.AREA_DESC,
       C.CITY_DESC,
       A.HUAXIAO_NAME,
       A.XIAOQU_NAME,
       A.BOX_NAME, 
       A.PORT_CNT,
       A.USE_CNT,
       A.UNUSE_CNT 
  FROM (SELECT *
          FROM ALLDM.DM_ALARM_BOX_BASE_INFO T
         WHERE 1 = 1 {AND T.ACCT_MONTH = #ACCT_MONTH#} {AND T.AREA_NO = #AREA_NO#}) A,
       (SELECT AREA_NO     FACT_AREA_ID,
               DESCRIPTION AREA_DESC,
               IDX_NO      SORT_ID,
               AREA_NO     AREA_ID
          FROM NEW_ALLDMCODE.DMCODE_AREA) B,
       (SELECT CITY_NO FACT_AREA_ID, DESCRIPTION CITY_DESC, IDX_NO SORT_ID
          FROM NEW_ALLDMCODE.DMCODE_CITY
         WHERE {AREA_NO = #AREA_NO#} {AND CITY_NO = #CITY_NO#}
           AND CITY_LEVEL = 2) C
 WHERE 1 = 1
   AND A.AREA_NO = B.FACT_AREA_ID
   AND A.CITY_NO = C.FACT_AREA_ID












